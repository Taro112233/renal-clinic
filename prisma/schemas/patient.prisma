// prisma/schemas/patient.prisma

model Patient {
  id        String        @id @default(cuid())
  hn        String        @unique
  // prefix: SelectOption.value จาก category "prefix"
  prefix    String?
  firstName String
  lastName  String
  gender    Gender
  dateOfBirth DateTime?

  caseType     CaseType      @default(NEW)
  status       PatientStatus @default(ACTIVE)
  healthScheme HealthScheme

  diagnoses         PatientDiagnosis[]
  counselingRecords CounselingRecord[]

  newClinicDate DateTime?
  referDate     DateTime?
  referNote     String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  createdBy String

  @@index([hn])
  @@index([lastName, firstName])
  @@index([status])
  @@index([caseType])
  @@map("patients")
}

model PatientDiagnosis {
  id          String        @id @default(cuid())
  patientId   String
  patient     Patient       @relation(fields: [patientId], references: [id], onDelete: Cascade)
  diagnosis   RheuDiagnosis
  isPrimary   Boolean       @default(false)
  diagnosedAt DateTime?
  note        String?
  createdAt   DateTime      @default(now())

  @@index([patientId])
  @@index([diagnosis])
  @@map("patient_diagnoses")
}