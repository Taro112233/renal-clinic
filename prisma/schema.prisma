// This file is auto-generated. Do not edit manually.
// Edit files in prisma/schemas/ directory instead.
// Last generated: 2026-02-24T17:27:52.156Z
// HealthTech Sandbox

generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["driverAdapters"]
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}


// ==========================================
// BASE SCHEMA - V1.0
// ==========================================

// prisma/schemas/base.prisma

enum Gender {
  M
  F
}

enum CaseType {
  NEW
  OLD
}

enum PatientStatus {
  ACTIVE
  DISCHARGED
  REFERRED
  DECEASED
}

enum HealthScheme {
  UC
  SSS
  CSMBS
  OTHER
}

enum RheuDiagnosis {
  RA
  SLE
  SSC
  UCTD
  GOUT
  PSORA
  SPA
  OVERLAP_SYNDROME
  DERMATOMYOSITIS
  BEHCETS_DISEASE
  POLYMYALGIA_RHEUMATICA
  OTHER
}

enum CounselingType {
  PRE
  POST
}

enum AdrStatus {
  NO
  YES_DMARD
  YES_HQ
  YES_OTHER
  YES_DMARD_HQ
  YES_DMARD_OTHER
}

enum EyeAppointmentStatus {
  YES
  NO
  LOSS
  EXTERNAL_SCREENING
}

enum ConsultEyeResult {
  YES
  NO
  NOT_SUGGESTED
}

enum PopupHQAction {
  SET_NEW
  UPDATE
  EXISTING
  NONE
}

enum ComplianceStatus {
  COMPLIANT
  NON_COMPLIANT
  UNABLE_TO_ASSESS  // ✅ เพิ่ม: ประเมินไม่ได้
}

enum NonComplianceType {
  WRONG_METHOD
  FORGOT_DOSE
  SELF_ADJUST
  LOSS_FOLLOWUP
  STOPPED_DUE_TO_ADR  // ✅ เพิ่ม: หยุดยาจาก ADR
}

enum CyclophosphamideRoute {
  ORAL
  IV
}

// ✅ ตารางกลางสำหรับ dropdown options ทั้งหมด
// category examples:
//   prefix, dmard, eye_screening_status, eye_result,
//   popup_hq, alcohol, herb, smoking, drp_type,
//   me_type, contraception
model SelectOption {
  id          String   @id @default(cuid())
  category    String                        // กลุ่มของ dropdown เช่น "alcohol", "drp_type"
  value       String                        // ค่าที่เก็บใน DB เช่น "YES_BEER"
  label       String                        // label แสดงผล เช่น "Yes เบียร์"
  sortOrder   Int      @default(0)          // ลำดับการแสดงผล
  isActive    Boolean  @default(true)
  metadata    Json?                         // ข้อมูลเพิ่มเติม เช่น { "color": "warning" }

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@unique([category, value])
  @@index([category])
  @@index([category, isActive])
  @@map("select_options")
}

// ==========================================
// BETTER-AUTH SCHEMA - ADDITIONAL
// ==========================================

// prisma/schemas/better-auth.prisma

model User {
  id            String    @id @default(cuid())
  name          String
  email         String    @unique
  emailVerified Boolean   @default(false)
  image         String?
  firstName     String    @default("")
  lastName      String    @default("")
  phone         String?
  role          UserRole  @default(USER)
  status        String    @default("ACTIVE")
  isActive      Boolean   @default(true)
  lastLogin     DateTime?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  sessions          Session[]
  accounts          Account[]
  counselingRecords CounselingRecord[] @relation("PharmacistCounselingRecords")

  @@index([email])
  @@index([role])
  @@map("users")
}

model Session {
  id        String   @id @default(cuid())
  expiresAt DateTime
  token     String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  ipAddress String?
  userAgent String?
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([token])
  @@map("sessions")
}

model Account {
  id                    String    @id @default(cuid())
  accountId             String
  providerId            String
  userId                String
  user                  User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  accessToken           String?
  refreshToken          String?
  idToken               String?
  accessTokenExpiresAt  DateTime?
  refreshTokenExpiresAt DateTime?
  scope                 String?
  password              String?
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt

  @@index([userId])
  @@unique([providerId, accountId])
  @@map("accounts")
}

model Verification {
  id         String   @id @default(cuid())
  identifier String
  value      String
  expiresAt  DateTime
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@unique([identifier, value])
  @@map("verifications")
}

enum UserRole {
  USER
  ADMIN
  SUPERADMIN
}

// ==========================================
// COUNSELING SCHEMA - ADDITIONAL
// ==========================================

// prisma/schemas/counseling.prisma

model CounselingRecord {
  id             String         @id @default(cuid())

  // === ข้อมูลพื้นฐาน ===
  date           DateTime
  sequenceNumber Int?
  patientId      String
  patient        Patient        @relation(fields: [patientId], references: [id])
  pharmacistId   String
  pharmacist     User           @relation("PharmacistCounselingRecords", fields: [pharmacistId], references: [id])
  counselingType CounselingType

  // === ข้อมูลยา ===
  // dmards เก็บเป็น array of SelectOption.value จาก category "dmard"
  // เช่น ["MTX", "HCQ", "PRED"]
  currentDmards  String[]       @default([])
  hasDmards      Boolean        @default(false)
  otherMeds      String?

  // === ซักประวัติ ===
  historyNote    String?

  // === ADR ===
  adrStatus      AdrStatus      @default(NO)
  adrDescription String?

  // === HQ/CQ Eye Screening ===
  hasHQ                Boolean              @default(false)
  // eyeScreeningStatus: SelectOption.value จาก category "eye_screening_status"
  // เช่น "NORMAL", "PROBLEM", "NOT_ASSESSED"
  eyeScreeningStatus   String?
  eyeAppointmentStatus EyeAppointmentStatus?
  consultEyeResult     ConsultEyeResult?
  prevEyeDate          DateTime?
  // eyeResult: SelectOption.value จาก category "eye_result"
  // เช่น "NO_MACULOPATHY", "RO_MACULOPATHY", "DX_MACULOPATHY"
  eyeResult            String?
  nextEyeDate          DateTime?
  popupHQAction        PopupHQAction?

  // === Compliance ===
  complianceStatus   ComplianceStatus
  nonComplianceItems NonComplianceItem[]

  // === ยาเหลือ ===
  // เก็บเป็น JSON array: [{ "drugCode": "1M013B", "drugName": "MTX 2.5 mg", "quantity": 10 }]
  leftoverMeds Json?

  // === Health Behavior ===
  // แต่ละ field เก็บ SelectOption.value จาก category ที่ตรงกัน
  alcoholStatus  String?  // category: "alcohol"
  herbStatus     String?  // category: "herb"
  smokingStatus  String?  // category: "smoking"
  nsaidFromOther String?  // free text

  // === DRP ===
  hasDrp   Boolean   @default(false)
  drpItems DrpItem[]

  // === Contraception ===
  // contraceptionMethod: SelectOption.value จาก category "contraception"
  contraceptionMethod String?

  // === Medication Error ===
  hasME         Boolean @default(false)
  // meType: SelectOption.value จาก category "me_type"
  // เช่น "PRESCRIBING", "DISPENSING", "PROCESSING"
  meType        String?
  meDescription String?
  meLevel       String? // A-G (NCC MERP) — free text / enum เล็กเกินไป ไม่ต้องทำ table

  // === Lab Values ===
  labDate            DateTime?
  wbc                Float?
  absoluteNeutrophil Float?
  neutrophilPercent  Float?
  ast                Float?
  alt                Float?
  alp                Float?
  uricAcid           Float?
  creatinine         Float?
  albumin            Float?
  hsCRP              Float?
  labLevel           String?

  // === Cyclophosphamide ===
  hasCyclophosphamide         Boolean                @default(false)
  cyclophosphamideRoute       CyclophosphamideRoute?
  cyclophosphamideCumulativeDose Float?

  // === Note ===
  note String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([date])
  @@index([patientId])
  @@index([pharmacistId])
  @@index([date, pharmacistId])
  @@index([counselingType])
  @@map("counseling_records")
}

model NonComplianceItem {
  id                 String           @id @default(cuid())
  counselingRecordId String
  counselingRecord   CounselingRecord @relation(fields: [counselingRecordId], references: [id], onDelete: Cascade)

  orderNumber Int                // 1, 2, 3
  type        NonComplianceType
  description String?

  @@index([counselingRecordId])
  @@map("non_compliance_items")
}

model DrpItem {
  id                 String           @id @default(cuid())
  counselingRecordId String
  counselingRecord   CounselingRecord @relation(fields: [counselingRecordId], references: [id], onDelete: Cascade)

  orderNumber   Int
  drugCode      String?  // optional: อ้างอิง DrugMaster.drugCode
  drugName      String
  // drpType: SelectOption.value จาก category "drp_type"
  drpType       String
  // consultResult: "ACCEPT" | "NOT_ACCEPT" | "PENDING" — ใช้ string เพราะ simple
  consultResult String?

  @@index([counselingRecordId])
  @@map("drp_items")
}

// ==========================================
// DRUG SCHEMA - ADDITIONAL
// ==========================================

// prisma/schemas/drug.prisma

model DrugMaster {
  id        String   @id @default(cuid())
  drugCode  String   @unique
  drugName  String
  unitPrice Float
  isDmard   Boolean  @default(false)
  isHQ      Boolean  @default(false)
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([drugCode])
  @@index([isDmard])
  @@index([isHQ])
  @@map("drug_masters")
}

model DrugSavingRecord {
  id         String   @id @default(cuid())
  month      Int
  year       Int
  fiscalYear String

  drugCode   String
  drugName   String
  unitPrice  Float
  quantity   Int
  totalSaving Float

  isDmard    Boolean  @default(false)
  createdBy  String
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@unique([month, year, drugCode])
  @@index([fiscalYear])
  @@index([month, year])
  @@index([isDmard])
  @@map("drug_saving_records")
}

// ==========================================
// PATIENT SCHEMA - ADDITIONAL
// ==========================================

// prisma/schemas/patient.prisma

model Patient {
  id        String        @id @default(cuid())
  hn        String        @unique
  // prefix: SelectOption.value จาก category "prefix"
  prefix    String?
  firstName String
  lastName  String
  gender    Gender
  dateOfBirth DateTime?

  caseType     CaseType      @default(NEW)
  status       PatientStatus @default(ACTIVE)
  healthScheme HealthScheme

  diagnoses         PatientDiagnosis[]
  counselingRecords CounselingRecord[]

  newClinicDate DateTime?
  referDate     DateTime?
  referNote     String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  createdBy String

  @@index([hn])
  @@index([lastName, firstName])
  @@index([status])
  @@index([caseType])
  @@map("patients")
}

model PatientDiagnosis {
  id          String        @id @default(cuid())
  patientId   String
  patient     Patient       @relation(fields: [patientId], references: [id], onDelete: Cascade)
  diagnosis   RheuDiagnosis
  isPrimary   Boolean       @default(false)
  diagnosedAt DateTime?
  note        String?
  createdAt   DateTime      @default(now())

  @@index([patientId])
  @@index([diagnosis])
  @@map("patient_diagnoses")
}
